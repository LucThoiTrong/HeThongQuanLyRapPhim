<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Tài Khoản - PhimHay</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', Arial, sans-serif;
            line-height: 1.7;
            background: linear-gradient(135deg, #f0f2f5, #e3e8ee);
            color: #2d3748;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            /* padding-top sẽ được set bằng JS */
        }

        .container-fluid-header { /* Container riêng cho header để chiếm full width */
            width: 100%;
        }
        .container-fluid-header .container { /* Container bên trong header để giới hạn nội dung */
            width: 90%;
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px; /* Giữ padding nếu cần */
        }


        .main-content-area { /* Thay thế main-profile-content-wrapper */
            flex-grow: 1;
            width: 100%;
            display: flex; /* Để .container bên trong có thể căn giữa và chiếm không gian */
            /* padding-top sẽ được set bằng JS, nhưng có thể bỏ nếu header fixed và body có padding-top */
        }

        .main-content-area > .container { /* Đây là .container chứa .profile-page-container */
            width: 90%; /* Hoặc 100% nếu bạn muốn .profile-page-container quyết định max-width */
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
            padding: 20px 0px; /* Chỉ padding trên dưới, không padding trái phải để profile-page-container full width */
            display: flex; /* Quan trọng */
            flex-grow: 1; /* Quan trọng */
        }


        /* --- HEADER --- */
        header {
            background: linear-gradient(90deg, #1a202c, #2d3748);
            color: #fff;
            padding: 1.2rem 0;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        header .container { /* Style cho container bên trong header */
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        header .logo a {
            color: #fff;
            font-size: 2em;
            font-weight: 700;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        header .logo a i {
            color: #f56565; /* Màu đỏ cho icon phim */
            font-size: 1.2em;
        }

        header nav {
            flex-grow: 1;
            display: flex;
            justify-content: center;
        }

        header nav ul {
            list-style: none;
            display: flex;
            gap: 20px;
            padding-left: 0; /* Reset default padding */
        }

        header nav ul li a {
            color: #e2e8f0;
            text-decoration: none;
            font-size: 1em;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        header nav ul li a:hover,
        header nav ul li a.active-header-link { /* Class cho link active trong header dropdown */
            background: #f56565; /* Màu đỏ */
            color: #fff;
        }

        .header-actions {
            display: flex;
            align-items: center;
        }
        .user-menu-container {
            position: relative;
        }
        .user-menu-container > a { /* Nút "Chào, Tên" */
            background: linear-gradient(45deg, #3182ce, #63b3ed); /* Gradient xanh */
            color: #fff;
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px; /* Khoảng cách giữa icon và text */
        }
        .user-menu-container > a:hover {
            background: linear-gradient(45deg, #2b6cb0, #4299e1);
        }
        .user-menu-container .dropdown-menu-content {
            display: none;
            position: absolute;
            top: calc(100% + 5px); /* Cách nút một chút */
            right: 0;
            background: #fff;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            z-index: 1001; /* Cao hơn header */
            min-width: 200px;
            padding: 8px 0; /* Padding cho top/bottom của dropdown */
            border: 1px solid #e2e8f0;
        }
        .user-menu-container:hover .dropdown-menu-content {
            display: block;
        }
        .user-menu-container .dropdown-menu-content a {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            color: #2d3748;
            text-decoration: none;
            font-size: 0.95em;
            gap: 10px; /* Khoảng cách icon và text trong dropdown item */
        }
        .user-menu-container .dropdown-menu-content a:hover {
            background-color: #f0f2f5;
        }
        .user-menu-container .dropdown-menu-content a i {
            color: #718096; /* Màu icon trong dropdown */
            width: 16px; /* Đảm bảo icon căn đều */
            text-align: center;
        }


        /* --- PROFILE PAGE CONTAINER --- */
        .profile-page-container {
            display: flex;
            width: 100%;    /* Chiếm toàn bộ width của .container cha */
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden; /* Quan trọng để bo góc được áp dụng cho con */
            flex-grow: 1; /* Để chiếm không gian còn lại */
        }

        /* --- PROFILE SIDEBAR --- */
        .profile-sidebar {
            width: 280px; /* Tăng nhẹ độ rộng sidebar */
            background: #2d3748; /* Màu nền tối cho sidebar */
            padding: 25px 0; /* Giảm padding top/bottom một chút, không padding trái phải ở đây */
            color: #e2e8f0;
            flex-shrink: 0; /* Không co lại khi content lớn */
        }

        .profile-sidebar .user-info-section {
            text-align: left; /* Cho thông tin user căn trái */
            margin-bottom: 25px; /* Giảm margin bottom */
            padding: 0 25px; /* Đồng bộ padding với nav link */
        }
        .profile-sidebar .user-info-section h4 {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 4px; /* Giảm margin */
            color: #fff;
        }
        .profile-sidebar .user-info-section p {
            font-size: 0.88em;
            color: #a0aec0; /* Màu chữ nhạt hơn cho email */
            word-break: break-all; /* Tránh email dài làm vỡ layout */
        }

        .profile-sidebar nav ul {
            list-style: none;
            padding-left: 0; /* Reset default padding */
        }
        .profile-sidebar nav ul li a {
            display: flex;
            align-items: center;
            padding: 14px 25px; /* Điều chỉnh padding */
            color: #e2e8f0;
            text-decoration: none;
            font-size: 0.95em; /* Điều chỉnh font size */
            font-weight: 500;
            border-left: 4px solid transparent; /* Border cho active link */
            transition: background-color 0.2s ease, border-left-color 0.2s ease, color 0.2s ease;
        }
        .profile-sidebar nav ul li a i {
            margin-right: 12px; /* Giảm margin */
            font-size: 1.1em; /* Điều chỉnh icon size */
            width: 20px; /* Đảm bảo icon căn đều */
            text-align: center;
        }
        .profile-sidebar nav ul li a:hover {
            background-color: #4a5568; /* Màu nền khi hover */
            color: #fff;
        }
        .profile-sidebar nav ul li a.active {
            background-color: #1a202c; /* Nền đậm hơn cho active */
            border-left-color: #f56565; /* Màu đỏ cho border active */
            color: #fff;
            font-weight: 600;
        }
        .profile-sidebar nav ul li a.active i {
            color: #f56565; /* Màu đỏ cho icon active */
        }


        /* --- PROFILE CONTENT --- */
        .profile-content {
            flex-grow: 1;
            padding: 25px 35px; /* Điều chỉnh padding */
            overflow-y: auto; /* Scroll nếu content dài */
            background-color: #fff; /* Đảm bảo nền trắng cho content */
        }
        .profile-content-section { display: none; } /* Mặc định ẩn các section */
        .profile-content-section.active { display: block; } /* Hiện section active */

        .profile-content-section h2 {
            font-size: 1.9em; /* Điều chỉnh font size */
            color: #1a202c;
            font-weight: 600;
            margin-bottom: 25px; /* Điều chỉnh margin */
            padding-bottom: 12px; /* Điều chỉnh padding */
            border-bottom: 1px solid #e2e8f0; /* Đường gạch chân tiêu đề */
            display: flex;
            align-items: center;
        }
        .profile-content-section h2 i {
            margin-right: 10px; /* Điều chỉnh margin */
            color: #f56565; /* Màu đỏ cho icon tiêu đề */
        }

        /* Styling cho form trong "Thông tin cá nhân" */
        .profile-form .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); /* Điều chỉnh minmax */
            gap: 20px; /* Điều chỉnh gap */
        }
        .profile-form .form-group {
            position: relative; /* Cho icon và message lỗi */
            margin-bottom: 5px; /* Giảm khoảng cách nếu có message lỗi bên dưới */
        }
        .profile-form label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px; /* Điều chỉnh margin */
            color: #4a5568;
            font-size: 0.9em;
        }
        .profile-form .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        .profile-form input[type="text"],
        .profile-form input[type="email"],
        .profile-form input[type="tel"],
        .profile-form input[type="date"],
        .profile-form input[type="password"], /* Thêm cho modal */
        .profile-form select {
            width: 100%;
            padding: 10px 12px; /* Điều chỉnh padding */
            padding-left: 38px; /* Điều chỉnh padding cho icon */
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 0.92em; /* Điều chỉnh font size */
            color: #2d3748;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #f8fafc; /* Nền input nhạt */
        }
        .profile-form input[readonly] {
            background-color: #e9ecef; /* Màu xám nhạt hơn */
            cursor: not-allowed;
            color: #718096;
        }
        .profile-form select {
            appearance: none; /* Bỏ giao diện mặc định của select */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%234A5568' class='bi bi-chevron-down' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center; /* Điều chỉnh vị trí icon */
            padding-right: 35px; /* Điều chỉnh padding để không che icon */
        }
        .profile-form select:invalid { /* Style cho option disabled được chọn */
            color: #718096;
        }
        .profile-form input:focus,
        .profile-form select:focus {
            border-color: #3182ce; /* Màu border khi focus */
            outline: none;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2); /* Box shadow khi focus */
            background-color: #fff; /* Nền trắng khi focus */
        }
        .profile-form .symbol-input {
            position: absolute;
            left: 12px; /* Điều chỉnh vị trí icon */
            top: 50%;
            transform: translateY(-50%);
            color: #718096;
            font-size: 1em;
            pointer-events: none; /* Để click xuyên qua icon */
        }
        .profile-form .form-actions {
            grid-column: 1 / -1; /* Cho action chiếm full grid */
            margin-top: 25px;
            display: flex;
            gap: 12px; /* Điều chỉnh gap */
            justify-content: flex-start; /* Căn trái các nút */
        }
        .profile-form .btn-save,
        .profile-form .btn-change-password {
            background: linear-gradient(45deg, #e53e3e, #f56565); /* Gradient đỏ */
            color: #fff;
            padding: 10px 22px; /* Điều chỉnh padding */
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.95em; /* Điều chỉnh font size */
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex; /* Cho icon và text thẳng hàng */
            align-items: center;
            gap: 8px;
        }
        .profile-form .btn-save:hover,
        .profile-form .btn-change-password:hover {
            background: linear-gradient(45deg, #c53030, #e53e3e); /* Đậm hơn khi hover */
            transform: translateY(-2px); /* Hiệu ứng nhấc lên */
        }
        .profile-form .btn-change-password {
            background: linear-gradient(45deg, #3182ce, #63b3ed); /* Gradient xanh cho nút đổi MK */
        }
        .profile-form .btn-change-password:hover {
            background: linear-gradient(45deg, #2b6cb0, #4299e1);
        }

        /* Styling cho "Lịch sử" và "Mã giảm giá" */
        .history-table, .coupon-list {
            width: 100%;
            border-collapse: collapse; /* Gộp border */
            margin-top: 15px; /* Điều chỉnh margin */
            font-size: 0.9em;
        }
        .history-table th, .history-table td,
        .coupon-list th, .coupon-list td {
            border: 1px solid #e2e8f0;
            padding: 10px 12px; /* Điều chỉnh padding */
            text-align: left;
            vertical-align: middle;
        }
        .history-table th, .coupon-list th {
            background-color: #f8fafc; /* Nền header bảng */
            font-weight: 600;
            color: #4a5568;
        }
        .history-table td .status, .coupon-list td .status { /* Styling cho tag status */
            padding: 4px 8px; /* Điều chỉnh padding */
            border-radius: 12px; /* Điều chỉnh bo góc */
            font-size: 0.82em; /* Điều chỉnh font size */
            font-weight: 500;
            color: #fff;
            white-space: nowrap; /* Tránh xuống dòng */
        }
        .history-table td .status.completed { background-color: #34d399; } /* Xanh lá */
        .history-table td .status.pending { background-color: #f59e0b; } /* Vàng cam */
        .history-table td .status.cancelled { background-color: #ef4444; } /* Đỏ */
        .history-table td .status.refunded { background-color: #63b3ed; } /* Xanh dương */

        .coupon-list .coupon-code {
            font-weight: bold;
            color: #e53e3e; /* Màu đỏ cho mã coupon */
            background-color: #fee2e2; /* Nền nhạt cho mã coupon */
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
            font-size: 0.95em; /* Tăng nhẹ font size */
        }
        .coupon-list .btn-copy-coupon {
            background: #63b3ed; /* Xanh cho nút copy */
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em; /* Điều chỉnh font size */
            transition: background-color 0.2s ease;
        }
        .coupon-list .btn-copy-coupon:hover { background: #4299e1; }
        .coupon-list td .status.active { background-color: #34d399; } /* Xanh lá */
        .coupon-list td .status.expired { background-color: #9ca3af; } /* Xám */
        .coupon-list td .status.used { background-color: #fbbf24; } /* Vàng */


        .no-data-message {
            text-align: center;
            padding: 35px 20px; /* Điều chỉnh padding */
            color: #718096;
            font-size: 1.05em; /* Điều chỉnh font size */
        }
        .no-data-message i {
            font-size: 2.8em; /* Điều chỉnh icon size */
            display: block;
            margin-bottom: 12px; /* Điều chỉnh margin */
            color: #cbd5e0; /* Màu icon nhạt */
        }

        /* --- FOOTER --- */
        footer {
            background: #2c3e50; /* Màu nền tối cho footer */
            color: #bdc3c7; /* Màu chữ nhạt */
            text-align: center;
            padding: 25px 0; /* Điều chỉnh padding */
            margin-top: auto; /* Đẩy footer xuống cuối nếu trang ngắn */
        }
        footer .container { display: flex; flex-direction: column; align-items: center; }
        .footer-nav ul { list-style: none; padding: 0; margin-bottom: 12px; display: flex; flex-wrap: wrap; justify-content: center; gap: 18px;}
        .footer-nav ul li a { color: #bdc3c7; text-decoration: none; font-size: 0.92em; transition: color 0.3s ease; }
        .footer-nav ul li a:hover { color: #fff; } /* Sáng hơn khi hover */
        .social-media { margin-bottom: 12px; display: flex; justify-content: center; gap: 12px; }
        .social-media a { color: #bdc3c7; font-size: 1.5em; text-decoration: none; transition: color 0.3s ease; }
        .social-media a:hover { color: #e74c3c; } /* Màu đỏ khi hover icon social */
        footer p { font-size: 0.88em; line-height: 1.5; }
        footer p:not(:last-child) { margin-bottom: 4px; }


        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 992px) { /* Tablet và mobile ngang */
            header .container { justify-content: space-between; }
            .logo { order: 1; width: auto; text-align: left; margin-bottom: 0; }
            header nav { order: 2; width: auto; margin: 0 15px; }
            .header-actions { order: 3; width: auto; text-align: right; margin-top: 0; }


            .profile-page-container {
                flex-direction: column; /* Sidebar trên, content dưới */
            }
            .profile-sidebar {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: stretch;
                padding: 20px;
                height: auto; /* Reset height */
            }
            .profile-sidebar .user-info-section {
                margin-bottom: 15px;
                padding: 0; /* Reset padding */
                text-align: center; /* Căn giữa info trên mobile */
            }
            .profile-sidebar nav { width: 100%; }
            .profile-sidebar nav ul {
                display: flex;
                flex-direction: row; /* Nav nằm ngang */
                justify-content: space-around;
                border-top: 1px solid #4a5568; /* Ngăn cách info và nav */
                padding-top: 10px;
                gap: 5px; /* Khoảng cách giữa các item nav */
            }
            .profile-sidebar nav ul li a {
                padding: 10px 8px; /* Giảm padding cho vừa */
                font-size: 0.85em; /* Giảm font */
                border-left: none; /* Bỏ border trái */
                border-bottom: 3px solid transparent; /* Border dưới cho active */
                justify-content: center; /* Căn giữa nội dung link */
                text-align: center;
            }
            .profile-sidebar nav ul li a i { margin-right: 5px; font-size: 1em;}
            .profile-sidebar nav ul li a.active {
                border-bottom-color: #f56565; /* Màu đỏ cho border active */
                background-color: transparent; /* Bỏ nền active */
                color: #f56565; /* Màu chữ active */
            }
            .profile-sidebar nav ul li a.active i { color: #f56565; }

            .profile-content { padding: 20px; } /* Giảm padding content */
            .profile-content-section h2 { font-size: 1.6em; margin-bottom: 20px; }
            .profile-form .form-grid { grid-template-columns: 1fr; gap: 15px; } /* 1 cột cho form */
        }

        @media (max-width: 768px) { /* Mobile nhỏ hơn */
            header nav ul { gap: 10px; }
            header nav ul li a { padding: 8px 10px; font-size: 0.9em; }

            .profile-sidebar nav ul {
                flex-wrap: wrap; /* Cho phép wrap nếu không đủ chỗ */
                justify-content: center;
            }
            .profile-sidebar nav ul li {
                flex-basis: calc(50% - 10px); /* 2 item mỗi hàng, có gap */
                margin-bottom: 5px;
            }
            .profile-sidebar nav ul li a { width: 100%; }
        }

        @media (max-width: 480px) { /* Mobile rất nhỏ */
            header nav { display: none; } /* Ẩn nav chính, chỉ còn user menu */
            .user-menu-container > a { padding: 6px 10px; font-size: 0.9em; }
            .user-menu-container .dropdown-menu-content { min-width: 160px;}
            .user-menu-container .dropdown-menu-content a { padding: 8px 15px; font-size: 0.9em;}

            .profile-sidebar nav ul li {
                flex-basis: 100%; /* 1 item mỗi hàng */
            }
            .profile-content { padding: 15px;}
            .profile-content-section h2 {font-size: 1.4em; margin-bottom: 15px;}
            .profile-form .form-actions { flex-direction: column; gap: 10px; } /* Nút action xếp dọc */
            .profile-form .btn-save, .profile-form .btn-change-password { width: 100%; justify-content: center;}

            .history-table, .coupon-list { font-size: 0.85em; }
            .history-table th, .history-table td,
            .coupon-list th, .coupon-list td { padding: 8px; }
            .coupon-list .btn-copy-coupon { padding: 4px 8px; font-size: 0.8em; }
        }

        /* --- CSS CHO MODAL ĐỔI MẬT KHẨU --- */
        .modal-overlay {
            display: none; /* Mặc định ẩn */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Nền mờ */
            z-index: 1050; /* Cao hơn mọi thứ */
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.active { /* Class để hiện modal */
            display: flex;
        }
        .modal-container {
            background-color: #fff;
            padding: 30px 35px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 480px; /* Giới hạn chiều rộng modal */
            position: relative;
            animation: slideDownModal 0.3s ease-out; /* Animation khi hiện */
        }
        @keyframes slideDownModal {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        .modal-header h3 {
            font-size: 1.5em;
            color: #1a202c;
            font-weight: 600;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 1.8em;
            color: #718096;
            cursor: pointer;
            padding: 0;
            line-height: 1; /* Căn giữa dấu X */
            transition: color 0.2s ease;
        }
        .modal-close-btn:hover {
            color: #f56565; /* Màu đỏ khi hover nút đóng */
        }

        .modal-body .form-group { /* Sử dụng class .form-group của .profile-form */
            margin-bottom: 20px; /* Tăng khoảng cách giữa các trường trong modal */
        }
        /* Input trong modal dùng chung style với .profile-form input[type="password"] đã có */
        /* Tuy nhiên, input password trong modal sẽ không có icon bên trái */
        .modal-body input[type="password"] {
            padding-left: 15px !important; /* Override padding-left của .profile-form input */
            font-size: 0.95em;
        }


        .modal-footer {
            margin-top: 30px;
            text-align: right; /* Căn phải các nút footer */
        }
        .modal-footer .btn-modal-save {
            background: linear-gradient(45deg, #e53e3e, #f56565); /* Gradient đỏ */
            color: #fff;
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .modal-footer .btn-modal-save:hover {
            background: linear-gradient(45deg, #c53030, #e53e3e);
        }
        .modal-footer .btn-modal-cancel {
            background-color: #e2e8f0; /* Nền xám cho nút hủy */
            color: #4a5568;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            margin-right: 10px; /* Khoảng cách với nút lưu */
            transition: background-color 0.3s ease;
        }
        .modal-footer .btn-modal-cancel:hover {
            background-color: #cbd5e0; /* Đậm hơn khi hover */
        }

        /* Styling cho message lỗi (cả Thymeleaf và JS) */
        .password-validation-error {
            color: red;
            font-size: 0.85em;
            margin-top: 5px;
            display: none; /* Mặc định ẩn, JS hoặc Thymeleaf sẽ hiện */
        }
        .error-message { /* Class chung cho lỗi từ Thymeleaf field errors */
            color: red;
            font-size: 0.85em;
            margin-top: 5px;
            display: block; /* Luôn hiển thị nếu có lỗi */
        }
        /* CSS cho các div alert thông báo chung */
        .alert {
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid transparent;
            border-radius: 5px;
        }
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

    </style>
</head>
<body>
<header id="pageHeader">
    <div class="container-fluid-header">
        <div class="container">
            <div class="logo">
                <a th:href="@{/}"><i class="fas fa-film"></i> PhimHay</a>
            </div>
            <nav>
                <ul>
                    <li><a th:href="@{/}">Trang Chủ</a></li>
                    <li><a th:href="@{/movies/now-showing}">Phim Đang Chiếu</a></li>
                    <li><a th:href="@{/movies/coming-soon}">Phim Sắp Chiếu</a></li>
                    <li><a th:href="@{/coupon-general}">Mã Giảm Giá</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <div class="user-menu-container">
                    <a href="#" id="userProfileLinkToggle">
                        <i class="fas fa-user-circle"></i>
                        <span id="headerUserDisplayName"
                              th:text="${khachHang != null && khachHang.hoTen != null && !khachHang.hoTen.trim().isEmpty()} ? 'Chào, ' + ${khachHang.hoTen.substring(khachHang.hoTen.lastIndexOf(' ') + 1)} : 'Chào, Khách'"></span>
                        <i class="fas fa-chevron-down" style="font-size: 0.8em;"></i>
                    </a>
                    <div class="dropdown-menu-content">
                        <a th:href="@{/user/profile}" class="active-header-link"> <i class="fas fa-user-edit"></i>Quản lý tài khoản
                        </a>
                        <a th:href="@{/logout}">
                            <i class="fas fa-sign-out-alt"></i>Đăng xuất
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="main-content-area" id="mainContentArea">
    <div class="container">
        <div class="profile-page-container" th:if="${khachHang != null}">
            <aside class="profile-sidebar">
                <div class="user-info-section">
                    <h4 id="sidebarUserDisplayName" th:text="${khachHang.hoTen ?: 'Chưa cập nhật'}">Trần Văn Admin</h4>
                    <p id="sidebarUserEmailDisplay" th:text="${khachHang.email ?: 'Chưa cập nhật'}">admin@phimhay.com</p>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="profile-nav-link active" data-target="info-section"><i class="fas fa-user-cog"></i>Thông tin cá nhân</a></li>
                        <li><a href="#" class="profile-nav-link" data-target="booking-history-section"><i class="fas fa-history"></i>Lịch sử đặt vé</a></li>
                        <li><a href="#" class="profile-nav-link" data-target="refund-history-section"><i class="fas fa-undo-alt"></i>Lịch sử hoàn trả</a></li>
                        <li><a href="#" class="profile-nav-link" data-target="my-coupons-section"><i class="fas fa-tags"></i>Mã giảm giá của tôi</a></li>
                    </ul>
                </nav>
            </aside>

            <main class="profile-content">
                <section id="info-section" class="profile-content-section active">
                    <h2><i class="fas fa-id-card"></i>Thông tin cá nhân</h2>
                    <form class="profile-form" id="personalInfoForm" th:action="@{/user/profile/update}" th:object="${khachHang}" method="post">
                        <div th:if="${param.success_update_info != null}" class="alert alert-success" role="alert">
                            Cập nhật thông tin cá nhân thành công!
                        </div>
                        <div th:if="${param.error_update_info != null}" class="alert alert-danger" role="alert"
                             th:text="${param.error_update_info_message ?: 'Cập nhật thông tin cá nhân thất bại! Vui lòng thử lại.'}">
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="ho_ten">Họ và tên</label>
                                <div class="input-wrapper">
                                    <span class="symbol-input"><i class='bx bx-user-circle'></i></span>
                                    <input type="text" id="ho_ten" th:field="*{hoTen}" required>
                                </div>
                                <small th:if="${#fields.hasErrors('hoTen')}" th:errors="*{hoTen}" class="error-message"></small>
                            </div>
                            <div class="form-group">
                                <label for="ten_dang_nhap">Tên đăng nhập</label>
                                <div class="input-wrapper">
                                    <span class="symbol-input"><i class='bx bx-user'></i></span>
                                    <input type="text" id="ten_dang_nhap" name="ten_dang_nhap_display" th:value="${khachHang.tkDoiTuongSuDung.tenDangNhap}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email_info">Email</label>
                                <div class="input-wrapper">
                                    <span class="symbol-input"><i class='bx bx-envelope'></i></span>
                                    <input type="email" id="email_info" th:field="*{email}" required>
                                </div>
                                <small th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="error-message"></small>
                            </div>
                            <div class="form-group">
                                <label for="so_dien_thoai">Số điện thoại</label>
                                <div class="input-wrapper">
                                    <span class="symbol-input"><i class='bx bx-phone'></i></span>
                                    <input type="tel" id="so_dien_thoai" th:field="*{soDienThoai}">
                                </div>
                                <small th:if="${#fields.hasErrors('soDienThoai')}" th:errors="*{soDienThoai}" class="error-message"></small>
                            </div>
                            <div class="form-group">
                                <label for="ngay_sinh">Ngày sinh</label>
                                <div class="input-wrapper">
                                    <span class="symbol-input"><i class='bx bx-calendar'></i></span>
                                    <input type="date" id="ngay_sinh" th:field="*{ngaySinh}"
                                           th:value="${khachHang != null && khachHang.ngaySinh != null ? #dates.format(khachHang.ngaySinh, 'yyyy-MM-dd') : ''}">
                                </div>
                                <small th:if="${#fields.hasErrors('ngaySinh')}" th:errors="*{ngaySinh}" class="error-message"></small>
                            </div>
                            <div class="form-group">
                                <label for="gioi_tinh">Giới tính</label>
                                <div class="input-wrapper">
                                    <span class="symbol-input"><i class='bx bx-male-female'></i></span>
                                    <select id="gioi_tinh" th:field="*{gioiTinh}">
                                        <option value="" disabled>Chọn giới tính</option>
                                        <option value="NAM">Nam</option>
                                        <option value="NU">Nữ</option>
                                        <option value="KHAC">Khác</option>
                                    </select>

                                </div>
                                <small th:if="${#fields.hasErrors('gioiTinh')}" th:errors="*{gioiTinh}" class="error-message"></small>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-save"><i class="fas fa-save"></i>Lưu thay đổi</button>
                            <button type="button" class="btn-change-password" id="btnOpenChangePasswordModal"><i class="fas fa-key"></i>Đổi mật khẩu</button>
                        </div>
                    </form>
                </section>

                <section id="booking-history-section" class="profile-content-section">
                    <h2><i class="fas fa-ticket-alt"></i>Lịch sử đặt vé</h2>
                    <div th:if="${khachHang.dsHoaDon == null || #lists.isEmpty(khachHang.dsHoaDon)}">
                        <div class="no-data-message" id="noBookingMessage">
                            <i class="fas fa-film-alt"></i> <p>Bạn chưa có lịch sử đặt vé nào.</p>
                        </div>
                    </div>
                    <table class="history-table" th:if="${khachHang.dsHoaDon != null && not #lists.isEmpty(khachHang.dsHoaDon)}">
                        <thead>
                        <tr>
                            <th>Tên phim</th> <th>Rạp</th> <th>Ngày chiếu</th> <th>SL</th> <th>Tổng tiền</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="booking : ${khachHang.dsHoaDon}">
                            <td th:text="${booking.suatChieu.phim.tenPhim}">Lật Mặt 7</td>
                            <td th:text="${booking.suatChieu.phongChieuPhim.rapPhim.tenRapPhim}">CGV Landmark 81</td>
                            <td th:text="${booking.suatChieu.ngayGioChieu != null ? #dates.format(booking.suatChieu.ngayGioChieu, 'dd/MM/yyyy') : '-'}">10/05/2025</td>
                            <td th:text="${booking.soLuongVeXemPhimDaMua()}">2</td>
                            <td th:text="${booking.tongGiaTien}">250,000đ</td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section id="refund-history-section" class="profile-content-section">
                    <h2><i class="fas fa-hand-holding-usd"></i>Lịch sử hoàn trả</h2>
                    <div th:if="${khachHang.dsHoanTra == null || #lists.isEmpty(khachHang.dsHoanTra)}">
                        <div class="no-data-message" id="noRefundMessage">
                            <i class="fas fa-file-invoice-dollar"></i> <p>Bạn chưa có lịch sử hoàn trả nào.</p>
                        </div>
                    </div>
                    <table class="history-table" th:if="${khachHang.dsHoanTra != null && not #lists.isEmpty(khachHang.dsHoanTra)}">
                        <thead>
                        <tr>
                            <th>Mã vé gốc</th> <th>Tên phim</th> <th>Ngày YC</th> <th>Lý do hoàn trả</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="refund : ${khachHang.dsHoanTra}">
                            <td th:text="${refund.hoaDon.idHoaDon}">PHV00115</td>
                            <td th:text="${refund.hoaDon.suatChieu.phim.tenPhim}">Gấu Béo</td>
                            <td th:text="${refund.ngayHoanTra != null ? #dates.format(refund.ngayHoanTra, 'dd/MM/yyyy') : '-'}">02/05/2025</td>
                            <td th:text="${refund.lyDoHoanTra}"></td>
                        </tr>
                        </tbody>
                    </table>
                </section>

                <section id="my-coupons-section" class="profile-content-section">
                    <h2><i class="fas fa-tags"></i>Mã giảm giá của tôi</h2>
                    <div th:if="${khachHang == null || khachHang.dsMaGiamGia == null || #lists.isEmpty(khachHang.dsMaGiamGia)}">
                        <div class="no-data-message" id="noCouponMessage">
                            <i class="fas fa-barcode"></i> <p>Bạn chưa có mã giảm giá nào.</p>
                        </div>
                    </div>

                    <table class="coupon-list" th:if="${khachHang != null && khachHang.dsMaGiamGia != null && not #lists.isEmpty(khachHang.dsMaGiamGia)}">
                        <thead>
                        <tr>
                            <th>Mã Code</th>
                            <th>Mô tả chi tiết</th>
                            <th>Hạn sử dụng</th>
                            <th>Điều kiện áp dụng</th>
                            <th>Trạng thái</th>
                            <th></th> </tr>
                        </thead>
                        <tbody>
                        <tr th:each="coupon : ${khachHang.dsMaGiamGia}">
                            <td>
                                <span class="coupon-code" th:text="${coupon.tenMaGiamGia}">MACODE</span>
                            </td>
                            <td th:text="|Giảm ${coupon.phanTramGiamGia}% (tối đa ${#numbers.formatInteger(coupon.giaTriGiamToiDa, 0, 'POINT')} VNĐ)|"></td>
                            <td th:text="${coupon.ngayKetThucApDung != null ? #temporals.format(coupon.ngayKetThucApDung, 'dd/MM/yyyy HH:mm') : '-'}">
                                dd/MM/yyyy HH:mm
                            </td>
                            <td th:text="|Đơn hàng từ ${#numbers.formatDecimal(coupon.hanMucApDung, 0, 'POINT', 0, 'COMMA')} VNĐ|"></td>
                            <td>
                                <span th:with="now=${T(java.time.LocalDateTime).now()}">
                                    <span th:if="${coupon.ngayKetThucApDung.isBefore(now)}" class="status expired">Hết hạn</span>
                                    <span th:elseif="${coupon.ngayBatDauApDung.isAfter(now)}" class="status upcoming">Sắp diễn ra</span>
                                    <span th:elseif="${!coupon.isTrangThaiSuDung()}" class="status used">Đã sử dụng/Vô hiệu</span> <span th:else class="status active">Còn hạn</span>
                                </span>
                            </td>
                            <td>
                                <button class="btn-copy-coupon" th:attr="data-coupon=${coupon.tenMaGiamGia}" title="Sao chép mã">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </section>
            </main>
        </div>
        <div th:unless="${khachHang != null}" class="profile-page-container" style="justify-content: center; align-items: center; text-align: center; padding: 20px;">
            <p>Không tìm thấy thông tin người dùng. Vui lòng <a th:href="@{/signin}" style="color: #e53e3e; text-decoration: underline;">đăng nhập</a> lại.</p>
        </div>
    </div>
</div>

<div class="modal-overlay" id="changePasswordModalOverlay">
    <div class="modal-container" id="changePasswordModalContainer">
        <div class="modal-header">
            <h3>Đổi mật khẩu</h3>
            <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
        </div>
        <div class="modal-body">
            <form class="profile-form" id="changePasswordForm" th:action="@{/user/profile/change-password}" method="post">
                <div th:if="${success_change_password_message != null}" class="alert alert-success" role="alert"
                     th:text="${success_change_password_message}">
                </div>
                <div th:if="${error_change_password_message != null}" class="alert alert-danger" role="alert"
                     th:text="${error_change_password_message}">
                </div>

                <div class="form-group">
                    <label for="current_password_modal">Mật khẩu hiện tại</label>
                    <input type="password" id="current_password_modal" name="currentPassword" placeholder="Bỏ trống nếu không yêu cầu" th:value="${val_currentPassword}">
                    <div th:if="${error_currentPassword != null}" class="password-validation-error" style="display:block" th:text="${error_currentPassword}"></div>
                </div>
                <div class="form-group">
                    <label for="new_password_modal">Mật khẩu mới</label>
                    <input type="password" id="new_password_modal" name="newPassword" placeholder="Nhập mật khẩu mới (ít nhất 6 ký tự)" required th:value="${val_newPassword}">
                    <div th:if="${error_newPassword != null}" class="password-validation-error" style="display:block" th:text="${error_newPassword}"></div>
                    <div class="password-validation-error js-error-new-password"></div> </div>
                <div class="form-group">
                    <label for="confirm_new_password_modal">Xác nhận mật khẩu mới</label>
                    <input type="password" id="confirm_new_password_modal" name="confirmNewPassword" placeholder="Nhập lại mật khẩu mới" required>
                    <div th:if="${error_confirmNewPassword != null}" class="password-validation-error" style="display:block" th:text="${error_confirmNewPassword}"></div>
                    <div class="password-validation-error js-error-confirm-password"></div> </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-modal-cancel" id="modalCancelBtn">Hủy</button>
            <button type="submit" form="changePasswordForm" class="btn-modal-save">Lưu mật khẩu</button>
        </div>
    </div>
</div>
<footer id="pageFooter">
    <div class="container">
        <div class="footer-nav">
            <ul>
                <li><a href="#">Về Chúng Tôi</a></li><li><a href="#">Điều Khoản Dịch Vụ</a></li><li><a href="#">Chính Sách Bảo Mật</a></li><li><a href="#">Liên Hệ</a></li><li><a href="#">FAQ</a></li>
            </ul>
        </div>
        <div class="social-media">
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a><a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a><a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a><a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
        </div>
        <p>&copy; <span id="currentYear" th:text="${#dates.year(#dates.createNow())}">2025</span> PhimHay. All rights reserved.</p>
        <p>Giao diện được xây dựng bởi AI.</p>
    </div>
</footer>

<script th:inline="javascript">
    /*<![CDATA[*/
    // Lấy các thông báo và giá trị từ FlashAttributes (nếu có) để JS có thể sử dụng
    const flash_success_change_password_message = /*[[${success_change_password_message}]]*/ null;
    const flash_error_change_password_message = /*[[${error_change_password_message}]]*/ null;
    const flash_error_currentPassword = /*[[${error_currentPassword}]]*/ null;
    const flash_error_newPassword = /*[[${error_newPassword}]]*/ null;
    const flash_error_confirmNewPassword = /*[[${error_confirmNewPassword}]]*/ null;

    // Lấy giá trị đã nhập trước đó (nếu có lỗi và backend trả về)
    const val_currentPassword_js = /*[[${val_currentPassword}]]*/ null;
    const val_newPassword_js = /*[[${val_newPassword}]]*/ null;


    document.addEventListener('DOMContentLoaded', () => {
        const pageHeader = document.getElementById('pageHeader');
        const mainContentArea = document.getElementById('mainContentArea');

        function setBodyPaddingTop() {
            if (pageHeader) {
                document.body.style.paddingTop = pageHeader.offsetHeight + 'px';
            }
        }
        setBodyPaddingTop(); // Set on initial load
        window.addEventListener('resize', setBodyPaddingTop); // Adjust on resize

        const navLinks = document.querySelectorAll('.profile-nav-link');
        const contentSections = document.querySelectorAll('.profile-content-section');

        function setActiveTabFromHash() {
            const hash = window.location.hash.substring(1);
            let activeLinkFound = false;

            navLinks.forEach(link => {
                const target = link.dataset.target;
                const section = document.getElementById(target);
                if (target === hash && section) {
                    link.classList.add('active');
                    section.classList.add('active');
                    activeLinkFound = true;
                } else {
                    link.classList.remove('active');
                    if(section) section.classList.remove('active');
                }
            });

            if (!activeLinkFound && navLinks.length > 0 && contentSections.length > 0) {
                navLinks[0].classList.add('active');
                contentSections[0].classList.add('active');
                if(history.replaceState) { // Cập nhật hash nếu không có hash hợp lệ
                    history.replaceState(null, null, '#' + navLinks[0].dataset.target);
                }
            }
        }

        setActiveTabFromHash(); // Set on page load
        window.addEventListener('hashchange', setActiveTabFromHash); // Listen for hash changes

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                // Thay đổi hash sẽ trigger sự kiện 'hashchange' và hàm setActiveTabFromHash
                window.location.hash = link.dataset.target;
            });
        });

        // --- JAVASCRIPT CHO MODAL ĐỔI MẬT KHẨU ---
        const btnOpenModal = document.getElementById('btnOpenChangePasswordModal');
        const modalOverlay = document.getElementById('changePasswordModalOverlay');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const modalCancelBtn = document.getElementById('modalCancelBtn');
        const changePasswordForm = document.getElementById('changePasswordForm');

        const currentPasswordInputModal = document.getElementById('current_password_modal');
        const newPasswordInputModal = document.getElementById('new_password_modal');
        const confirmNewPasswordInputModal = document.getElementById('confirm_new_password_modal');

        // Các div hiển thị lỗi từ JS
        const jsErrorNewPasswordDiv = modalOverlay.querySelector('.js-error-new-password');
        const jsErrorConfirmPasswordDiv = modalOverlay.querySelector('.js-error-confirm-password');

        function clearPasswordModalJSErrors() {
            if(jsErrorNewPasswordDiv) { jsErrorNewPasswordDiv.textContent = ''; jsErrorNewPasswordDiv.style.display = 'none'; }
            if(jsErrorConfirmPasswordDiv) { jsErrorConfirmPasswordDiv.textContent = ''; jsErrorConfirmPasswordDiv.style.display = 'none'; }
        }

        function resetAndRepopulatePasswordForm() {
            if(changePasswordForm) changePasswordForm.reset();
            // Điền lại giá trị cũ nếu có từ flash attributes (sau khi submit lỗi)
            if(currentPasswordInputModal && val_currentPassword_js) currentPasswordInputModal.value = val_currentPassword_js;
            if(newPasswordInputModal && val_newPassword_js) newPasswordInputModal.value = val_newPassword_js;
            // Confirm password không cần điền lại
        }

        if (btnOpenModal && modalOverlay) {
            btnOpenModal.addEventListener('click', () => {
                modalOverlay.classList.add('active');
                clearPasswordModalJSErrors(); // Xóa lỗi JS cũ
                resetAndRepopulatePasswordForm(); // Reset form và điền lại giá trị cũ (nếu có)
                // Các lỗi từ Thymeleaf (flash attributes) sẽ tự hiển thị nếu có
                if(currentPasswordInputModal) currentPasswordInputModal.focus();
            });
        }

        function closeModal() {
            if (modalOverlay) modalOverlay.classList.remove('active');
        }

        if (modalCloseBtn) modalCloseBtn.addEventListener('click', closeModal);
        if (modalCancelBtn) modalCancelBtn.addEventListener('click', closeModal);
        if (modalOverlay) {
            modalOverlay.addEventListener('click', (event) => {
                if (event.target === modalOverlay) closeModal(); // Đóng modal khi click ra ngoài
            });
        }

        if (changePasswordForm) {
            changePasswordForm.addEventListener('submit', (e) => {
                let isValid = true;
                clearPasswordModalJSErrors(); // Xóa lỗi JS cũ trước khi validate lại

                // Validate Mật khẩu mới
                if (newPasswordInputModal.value.trim() === '') {
                    if(jsErrorNewPasswordDiv) {
                        jsErrorNewPasswordDiv.textContent = 'Mật khẩu mới không được để trống.';
                        jsErrorNewPasswordDiv.style.display = 'block';
                    }
                    isValid = false;
                } else if (newPasswordInputModal.value.length < 6) {
                    if(jsErrorNewPasswordDiv) {
                        jsErrorNewPasswordDiv.textContent = 'Mật khẩu mới phải có ít nhất 6 ký tự.';
                        jsErrorNewPasswordDiv.style.display = 'block';
                    }
                    isValid = false;
                }

                // Validate Xác nhận mật khẩu mới
                if (confirmNewPasswordInputModal.value.trim() === '') {
                    if(jsErrorConfirmPasswordDiv) {
                        jsErrorConfirmPasswordDiv.textContent = 'Vui lòng xác nhận mật khẩu mới.';
                        jsErrorConfirmPasswordDiv.style.display = 'block';
                    }
                    isValid = false;
                } else if (newPasswordInputModal.value !== confirmNewPasswordInputModal.value) {
                    if(jsErrorConfirmPasswordDiv) {
                        jsErrorConfirmPasswordDiv.textContent = 'Mật khẩu xác nhận không khớp.';
                        jsErrorConfirmPasswordDiv.style.display = 'block';
                    }
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault(); // Ngăn submit nếu JS validation thất bại
                }
                // Nếu hợp lệ, form sẽ được submit bình thường
            });
        }

        // Kiểm tra nếu có thông báo lỗi từ redirect (flash messages) thì mở modal
        const shouldOpenModalDueToFlashError = flash_error_change_password_message ||
            flash_error_currentPassword ||
            flash_error_newPassword ||
            flash_error_confirmNewPassword;

        if (shouldOpenModalDueToFlashError && !modalOverlay.classList.contains('active')) {
            if (btnOpenModal) btnOpenModal.click(); // Tự động mở modal để hiển thị lỗi từ server
        }

        // Nếu đổi mật khẩu thành công và có thông báo, đóng modal (nếu đang mở) để user thấy trang chính
        // Thông báo thành công sẽ được Thymeleaf hiển thị trên trang chính.
        if (flash_success_change_password_message && modalOverlay.classList.contains('active')) {
            closeModal();
        }


        // Copy coupon
        document.querySelectorAll('.btn-copy-coupon').forEach(button => {
            button.addEventListener('click', function() {
                const couponCode = this.dataset.coupon;
                navigator.clipboard.writeText(couponCode).then(() => {
                    const originalHTML = this.innerHTML; // Lưu lại icon gốc
                    this.innerHTML = '<i class="fas fa-check" style="color: lightgreen;"></i>&nbsp;Đã&nbsp;chép';
                    setTimeout(() => { this.innerHTML = originalHTML; }, 1500);
                }).catch(err => {
                    console.error('Không thể sao chép: ', err);
                    // Có thể thêm thông báo lỗi cho người dùng ở đây nếu muốn
                });
            });
        });
    });
    /*]]>*/
</script>
</body>
</html>